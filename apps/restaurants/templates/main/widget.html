{% if user.is_authenticated %}
    <!-- 고정된 장바구니 위젯 위치 -->
    <div class="cart-widget" style="
        position: fixed;
        top: 33.33%;
        transform: translateY(-50%);
        right: 24px;
        width: 18rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border: 1px solid #e5e7eb;
        z-index: 9999;
        overflow-y: auto;
        max-height: 24rem;
    ">
   <!-- 헤더 -->
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid #e5e7eb; background-color: #eff6ff; border-radius: 12px 12px 0 0;">
        <h2 style="font-size: 1.125rem; font-weight: 700; color: #1e293b;">
            <i class="fas fa-shopping-cart" style="margin-right: 0.5rem; color: #2563eb;"></i>장바구니
        </h2>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <span id="cart-badge" style="background-color: #2563eb; color: white; font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 9999px; {% if cart_count|default:0 == 0 %}display:none;{% endif %}">
                {{ cart_count|default:0 }}개
            </span>
            <button onclick="toggleWidget()" style="padding: 0.25rem; border-radius: 9999px; background-color: transparent; cursor: pointer;">
                <i id="widget-toggle-icon" class="fas fa-chevron-down" style="font-size: 0.75rem; color: #475569;"></i>
            </button>
        </div>
    </div>

    <!-- 장바구니 내용 -->
    <div id="cart-content" style="max-height: 24rem; overflow-y: auto;">
        <div id="cart-items" style="padding: 1rem;">
            {% if cart and not cart.is_empty %}
                <ul class="list-group">
                {% for item in cart.items.all %}
                    <li class="list-group-item d-flex justify-content-between align-items-center" data-menu-id="{{ item.menu.id }}">
                        <div>
                            {{ item.menu.name }}
                            <br>
                            <small class="text-muted">{{ item.menu.price|floatformat:"0" }}원 x {{ item.quantity }}</small>
                        </div>
                        <div>
                            <span class="fw-bold me-3">{{ item.get_item_total|floatformat:"0" }}원</span>
                            <button class="btn btn-sm btn-outline-danger remove-from-cart-btn" data-menu-id="{{ item.menu.id }}">×</button>
                        </div>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <div style="text-align: center; color: #94a3b8; padding: 2rem 0;">
                    <i class="fas fa-shopping-cart" style="font-size: 3rem; opacity: 0.5; margin-bottom: 0.75rem;"></i>
                    <p style="font-size: 0.875rem;">장바구니가 비어있습니다</p>
                </div>
            {% endif %}
        </div>

       <!-- 합계 (조건 제거해서 무조건 보이게) -->
        <div id="cart-footer" style="border-top: 1px solid #e5e7eb; padding: 1rem; background-color: #f9fafb; border-radius: 0 0 12px 12px;">
            <div style="display: flex; justify-content: space-between; font-size: 0.875rem; color: #475569;">
                <span>총 <span id="total-items">{{ cart.items.all|length|default:0 }}</span>개</span>
                <span style="font-weight: 700; font-size: 1.125rem; color: #1e293b;" id="total-price">{{ cart.get_total_price|default:0|floatformat:"0" }}원</span>
            </div>
            <div style="margin-top: 0.5rem; display: flex; flex-direction: column; gap: 0.5rem;">
                <a style="width: 100%; background-color: #2563eb; color: white; padding: 0.5rem; border-radius: 0.5rem; font-weight: 500; font-size: 0.875rem; cursor: pointer; border: none; text-decoration: none; display: flex; align-items: center; justify-content: center;">
                    <button id="order-btn" style="width: 100%; background-color: #2563eb; color: white; padding: 0.5rem; border-radius: 0.5rem; font-weight: 500; font-size: 0.875rem; cursor: pointer; border: none;">
                        <i class="fas fa-credit-card" style="margin-right: 0.5rem;"></i>결제하기
                    </button>
                </a>
                <button onclick="clearCart()" style="width: 100%; border: 1px solid #d1d5db; color: #475569; padding: 0.5rem; border-radius: 0.5rem; font-weight: 500; font-size: 0.875rem; cursor: pointer; background-color: white;">
                    <i class="fas fa-trash" style="margin-right: 0.5rem;"></i>전체 비우기
                </button>
            </div>
        </div>
    </div>
</div>
{% endif %}